var app;!function(e){"use strict";var t=angular.module("app",["http-auth-interceptor","ui.router","ui.bootstrap","ui.bootstrap.tpls"]);t.constant("serviceURL","http://localhost:9000/"),t.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("main",{url:"/",template:"<main></main>"})}])}(app||(app={}));var app;!function(e){"use strict";var t=function(){function e(e,t,n){this.serviceURL=e,this.$http=t,this.$sce=n,this.searchFields=["heading_index","metadata_pubDate","metadata_module","heading_frontmatter","metadata_documentType","contents_index","heading_backmatter","heading_body","contents_frontmatter","contents_TOC","metadata_notes","metadata_fullTitle","heading_TOC","contents_titlePage","contents_body","metadata_language","contents_backmatter"],this.resultFields=["heading_index","metadata_documentID","metadata_pubDate","metadata_module","heading_frontmatter","metadata_documentType","heading_backmatter","heading_body","metadata_notes","metadata_fullTitle","heading_TOC","metadata_language","metadata_ESTCID"],this.selectedSearchFields={},this.selectedResultFields={},this.queryWords={},this.query="",this.queryURL="",this.mf=1,this.searchURL=n.trustAsResourceUrl(e+"search");for(var l=0,s=this.searchFields;l<s.length;l++){var a=s[l];0!==a.indexOf("contents_")&&0!==a.indexOf("heading_")||(this.selectedSearchFields[a]=!0)}this.selectedResultFields.metadata_ESTCID=!0}return e.prototype.selectAll=function(e,t,n){switch(e){case"search":for(var l=0,s=this.searchFields;l<s.length;l++){var a=s[l];0===a.indexOf(t)&&(this.selectedSearchFields[a]=n)}break;case"result":for(var r=0,c=this.resultFields;r<c.length;r++){var a=c[r];0===a.indexOf(t)&&(this.selectedResultFields[a]=n)}break;default:throw"cannot happen"}},e.prototype.updateQuery=function(e,t,n){var l=this;this.$http.get(this.serviceURL+"terms",{params:{q:e,d:t,cp:n,f:this.searchFields.filter(function(e){return l.selectedSearchFields[e]})}}).then(function(e){l.queryWords=e.data,l.selectedQueryWords={};for(var t in l.queryWords)l.selectedQueryWords[t]=!0})},e.prototype.loadExamples=function(){var e=this;this.$http.get(this.serviceURL+"jsearch",{params:{q:this.query,f:this.searchFields.filter(function(t){return e.selectedSearchFields[t]}),rf:this.resultFields.filter(function(t){return e.selectedResultFields[t]}),l:10,mf:this.mf},headers:{Accept:"application/json"}}).then(function(t){e.totalResults=t.data.total,e.returnedResultFields=t.data.fields,e.examples=t.data.results})},e.prototype.addToQuery=function(){for(var e in this.queryWords)this.selectedQueryWords[e]&&(this.query+=" "+(e.indexOf(" ")!==-1?'"'+e+'"':e));this.selectedQueryWords={},this.query=this.query.trim(),this.updateQueryURL()},e.prototype.updateQueryURL=function(){var e=this;this.queryURL=this.serviceURL+"search?q="+encodeURIComponent(this.query)+this.searchFields.filter(function(t){return e.selectedSearchFields[t]}).map(function(e){return"&f="+e}).join("")+this.resultFields.filter(function(t){return e.selectedResultFields[t]}).map(function(e){return"&rf="+e}).join("")+"&mf="+this.mf,this.loadExamples()},e.prototype.eccoSearch=function(e){this.iframeSrc=this.$sce.trustAsResourceUrl("http://find.galegroup.com/ecco/quickSearch.do?prodId=ECCO&bannerSearch=true&quickSearchTerm="+encodeURIComponent(e))},e}();angular.module("app").controller("MainComponentController",["serviceURL","$http","$sce",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.MainComponentController=t;var n=function(){function e(){this.controller="MainComponentController",this.templateUrl="partials/main.html"}return e}();angular.module("app").component("main",new n),e.MainComponent=n}(app||(app={})),function(e){try{e=angular.module("app")}catch(t){e=angular.module("app",[])}e.run(["$templateCache",function(e){e.put("partials/main.html",'\n<div class="row">\n  <form class="col-md-4 col-lg-3" action="{{$ctrl.searchURL}}" method="POST">\n    <h2>Configuration<i class="glyphicon glyphicon-chevron-down" ng-click="config=!config" ng-init="config=true"></i></h2>\n    <div ng-show="config">\n      <h3>Search fields</h3>\n      <button class="btn btn-success" ng-click="$ctrl.selectAll(\'search\',\'\',true)">All</button>\n      <button class="btn btn-danger" ng-click="$ctrl.selectAll(\'search\',\'\',false)">None</button>\n      <h4>Metadata</h4>\n      <button class="btn btn-sm btn-success" ng-click="$ctrl.selectAll(\'search\',\'metadata_\',true)">All</button>\n      <button class="btn btn-sm btn-danger" ng-click="$ctrl.selectAll(\'search\',\'metadata_\',false)">None</button>\n      <div class="checkbox-inline" ng-repeat="field in $ctrl.searchFields | filter:\'metadata_\'">\n        <label>\n          <input type="checkbox" name="f" value="{{field}}" ng-model="$ctrl.selectedSearchFields[field]"/>{{field.substring(9)}}\n        </label>\n      </div>\n      <h4>Headings</h4>\n      <button class="btn btn-sm btn-success" ng-click="$ctrl.selectAll(\'search\',\'heading_\',true)">All</button>\n      <button class="btn btn-sm btn-danger" ng-click="$ctrl.selectAll(\'search\',\'heading_\',false)">None</button>\n      <div class="checkbox-inline" ng-repeat="field in $ctrl.searchFields | filter:\'heading_\'">\n        <label>\n          <input type="checkbox" name="f" value="{{field}}" ng-model="$ctrl.selectedSearchFields[field]"/>{{field.substring(8)}}\n        </label>\n      </div>\n      <h4>Contents</h4>\n      <button class="btn btn-sm btn-success" ng-click="$ctrl.selectAll(\'search\',\'contents_\',true)">All</button>\n      <button class="btn btn-sm btn-danger" ng-click="$ctrl.selectAll(\'search\',\'contents_\',false)">None</button>\n      <div class="checkbox-inline" ng-repeat="field in $ctrl.searchFields | filter:\'contents_\'">\n        <label>\n          <input type="checkbox" name="f" value="{{field}}" ng-model="$ctrl.selectedSearchFields[field]"/>{{field.substring(9)}}\n        </label>\n      </div>\n      <h3>Result fields</h3>\n      <button class="btn btn-success" ng-click="$ctrl.selectAll(\'result\',\'\',true)">All</button>\n      <button class="btn btn-danger" ng-click="$ctrl.selectAll(\'result\',\'\',false)">None</button>\n      <h4>Metadata</h4>\n      <button class="btn btn-sm btn-success" ng-click="$ctrl.selectAll(\'result\',\'metadata_\',true)">All</button>\n      <button class="btn btn-sm btn-danger" ng-click="$ctrl.selectAll(\'result\',\'metadata_\',false)">None</button>\n      <div class="checkbox-inline" ng-repeat="field in $ctrl.resultFields | filter:\'metadata_\'">\n        <label>\n          <input type="checkbox" name="rf" value="{{field}}" ng-model="$ctrl.selectedResultFields[field]"/>{{field.substring(9)}}\n        </label>\n      </div>\n      <h4>Headings</h4>\n      <button class="btn btn-sm btn-success" ng-click="$ctrl.selectAll(\'result\',\'heading_\',true)">All</button>\n      <button class="btn btn-sm btn-danger" ng-click="$ctrl.selectAll(\'result\',\'heading_\',false)">None</button>\n      <div class="checkbox-inline" ng-repeat="field in $ctrl.resultFields | filter:\'heading_\'">\n        <label>\n          <input type="checkbox" name="rf" value="{{field}}" ng-model="$ctrl.selectedResultFields[field]"/>{{field.substring(8)}}\n        </label>\n      </div>\n    </div>\n    <h2>Search</h2>\n    <div class="form-inline">\n      <div class="form-group">\n        <label>Max edit distance</label>\n        <select ng-model="maxDistance" ng-init="maxDistance=\'1\'" ng-change="$ctrl.updateQuery(query,maxDistance,prefix)">\n          <option value="0">0</option>\n          <option value="1">1</option>\n          <option value="2">2</option>\n        </select>\n      </div>\n      <div class="form-group">\n        <label>Required common prefix length</label>\n        <input class="form-control" type="number" ng-model="prefix" ng-init="prefix=1" ng-change="$ctrl.updateQuery(query,maxDistance,prefix)"/>\n      </div>\n      <div class="checkbox">\n        <label>\n          <input type="checkbox" ng-model="transpose"/>Transposition is a single edit\n        </label>\n      </div>\n    </div>\n    <div class="form-group">\n      <label>Query</label>\n      <input class="form-control" type="text" ng-model="query" ng-change="$ctrl.updateQuery(query,maxDistance,prefix)" ng-model-options="{ debounce: 500 }"/>\n    </div>\n    <h2>Keywords</h2>\n    <script type="text/ng-template" id="popover"></script>\n    <div class="checkbox-inline" ng-repeat="(queryWord,frequency) in $ctrl.queryWords">\n      <input type="checkbox" ng-model="$ctrl.selectedQueryWords[queryWord]"/>\n      <label><span ng-click="$ctrl.eccoSearch(queryWord)">{{queryWord}} ({{frequency}})</span></label>\n    </div>\n    <button class="btn btn-success" ng-click="$ctrl.addToQuery()">Add to Query</button>\n    <h2>Query</h2>\n    <div class="form-inline">\n      <div class="form-group">\n        <label>Required term frequency</label>\n        <input class="form-control" type="number" ng-model="$ctrl.mf" ng-change="$ctrl.updateQueryURL()" name="mf"/>\n      </div>\n    </div>\n    <textarea class="form-control" rows="5" name="q" ng-model="$ctrl.query" ng-change="$ctrl.updateQueryURL()" ng-model-options="{debounce:1000}"></textarea>\n    <input class="form-control" readonly="readonly" type="text" ng-model="$ctrl.queryURL"/>\n    <div ng-show="$ctrl.totalResults">\n      <h3>Results</h3>({{$ctrl.totalResults}} results)\n      <table class="table table-condensed table-bordered table-striped">\n        <tr>\n          <th ng-repeat="field in $ctrl.returnedResultFields">{{field}}</th>\n        </tr>\n        <tr ng-repeat="row in $ctrl.examples">\n          <td ng-repeat="value in row"><span>{{value}}</span></td>\n        </tr>\n      </table>\n    </div>\n    <input class="btn btn-success" ng-show="$ctrl.queryURL" type="submit"/>\n  </form>\n  <div class="col-md-8 col-lg-9">\n    <div class="embed-responsive embed-responsive-4by3">\n      <iframe ng-src="{{$ctrl.iframeSrc}}"></iframe>\n    </div>\n  </div>\n</div>')}])}();